{"data":{"site":{"siteMetadata":{"title":"Jere`s Blog","author":"jerexyz"}},"markdownRemark":{"id":"eb71f68b-0d7e-54f7-a799-7371ace46729","excerpt":"mkcertAdvanced options:安装配置证书如何信任证书配置 webpackDevServer 的证书\n将 覆盖至 \n修改 添加安装 至需要代理的手机修改手机 wifi 代理至配置 host 注意：\n被代理手机需要安装并信任两个证书，一个是 anyproxy…","html":"<ol>\n<li>\n<p>mkcert</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Usage of mkcert:\n\n$ mkcert -install\nInstall the local CA <span class=\"token keyword\">in</span> the system trust store.\n\n$ mkcert example.org\nGenerate <span class=\"token string\">\"example.org.pem\"</span> and <span class=\"token string\">\"example.org-key.pem\"</span><span class=\"token keyword\">.</span>\n\n$ mkcert example.com myapp.dev localhost 127.0.0.1 ::1\nGenerate <span class=\"token string\">\"example.com+4.pem\"</span> and <span class=\"token string\">\"example.com+4-key.pem\"</span><span class=\"token keyword\">.</span>\n\n$ mkcert <span class=\"token string\">\"*.example.it\"</span>\nGenerate <span class=\"token string\">\"_wildcard.example.it.pem\"</span> and <span class=\"token string\">\"_wildcard.example.it-key.pem\"</span><span class=\"token keyword\">.</span>\n\n$ mkcert -uninstall\nUninstall the local CA <span class=\"token punctuation\">(</span>but <span class=\"token keyword\">do</span> not delete it<span class=\"token punctuation\">)</span>.</code></pre></div>\n</li>\n</ol>\n<p>Advanced options:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-cert-file FILE, -key-file FILE, -p12-file FILE\n    Customize the output paths.\n\n-client\n    Generate a certificate for client authentication.\n\n-ecdsa\n    Generate a certificate with an ECDSA key.\n\n-pkcs12\n    Generate a &quot;.p12&quot; PKCS #12 file, also know as a &quot;.pfx&quot; file,\n    containing certificate and key for legacy applications.\n\n-csr CSR\n    Generate a certificate based on the supplied CSR. Conflicts with\n    all other flags and arguments except -install and -cert-file.\n\n-CAROOT\n    Print the CA certificate and key storage location.\n\n$CAROOT (environment variable)\n    Set the CA certificate and key storage location. (This allows\n    maintaining multiple local CAs in parallel.)\n\n$TRUST_STORES (environment variable)\n    A comma-separated list of trust stores to install the local\n    root CA into. Options are: &quot;system&quot;, &quot;java&quot; and &quot;nss&quot; (includes\n    Firefox). Autodetected by default.\n```</code></pre></div>\n<ol>\n<li>安装<code class=\"language-text\">anyproxy</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install -g anyproxy</code></pre></div>\n<ol start=\"2\">\n<li>配置<code class=\"language-text\">anyproxy</code>证书</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">anyproxy-ca #生成rootCA证书，生成后需要手动信任\n// anyproxy --intercept #启动AnyProxy，并解析所有https请求\nnode config/ssl/proxy.js #启动代理</code></pre></div>\n<p><a href=\"http://anyproxy.io/cn/#%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE\">如何信任证书</a></p>\n<ol start=\"3\">\n<li>配置 webpackDevServer 的证书\n将<code class=\"language-text\">config/ssl/server.pem</code> 覆盖至 <code class=\"language-text\">/gmall/node_modules/webpack-dev-server/ssl</code>\n修改<code class=\"language-text\">/af-webpack/lib/dev.js</code> 添加</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> serverConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  disableHostCheck<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  compress<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  clientLogLevel<span class=\"token punctuation\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span>\n  hot<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  quiet<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  https<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'access-control-allow-origin'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  publicPath<span class=\"token punctuation\">:</span> webpackConfig<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>publicPath<span class=\"token punctuation\">,</span>\n  watchOptions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    ignored<span class=\"token punctuation\">:</span> <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  historyApiFallback<span class=\"token punctuation\">,</span>\n  overlay<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  host<span class=\"token punctuation\">:</span> <span class=\"token constant\">HOST</span><span class=\"token punctuation\">,</span>\n  proxy<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"4\">\n<li>\n<p>安装<code class=\"language-text\">config/ssl/CA.crt</code> 至需要代理的手机</p>\n</li>\n<li>\n<p>修改手机 wifi 代理至<code class=\"language-text\">本机IP:8001</code></p>\n</li>\n<li>\n<p>配置 host <code class=\"language-text\">127.0.0.1 test.niubi.com</code></p>\n</li>\n<li>\n<p><code class=\"language-text\">anyproxy</code></p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* eslint-disable */</span>\n<span class=\"token keyword\">const</span> AnyProxy <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'anyproxy'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  port<span class=\"token punctuation\">:</span> <span class=\"token number\">8001</span><span class=\"token punctuation\">,</span>\n  webInterface<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    enable<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    webPort<span class=\"token punctuation\">:</span> <span class=\"token number\">8002</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  throttle<span class=\"token punctuation\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n  forceProxyHttps<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  wsIntercept<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 不开启websocket代理</span>\n  silent<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  dangerouslyIgnoreUnauthorized<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> proxyServer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnyProxy<span class=\"token punctuation\">.</span>ProxyServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n\nproxyServer<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ready'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nproxyServer<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nproxyServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>注意：\n被代理手机需要安装并信任两个证书，一个是 anyproxy 的，一个是<code class=\"language-text\">config/ssl/CA.crt</code></p>\n<blockquote>\n<p><a href=\"http://blog.acwong.org/2016/03/05/change-webpack-certificate/\">change-webpack-certificate</a></p>\n</blockquote>\n<p><a href=\"https://github.com/FiloSottile/mkcert\">mkcert</a></p>","frontmatter":{"title":"微信H5移动端真机调试","date":"April 17, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/tools/cert-for-debug/","previous":{"fields":{"slug":"/weapp-tips/"},"frontmatter":{"title":"「微信小程序」开发问题汇总"}},"next":null}}